# [ASCII]
alias ascii-real='ascii-image-converter -Cfg --color-bg '
alias ascii1="ascii-image-converter -b -C"
alias ascii2="ascii-image-converter -b --dither -C"
alias ascii="ascii-image-converter"


#══════════════════════ 
#         mpv
#══════════════════════
alias mpv_radio='mpv --no-video'
alias mpv_playlist='mpv --shuffle --loop-playlist=inf --geometry=15%-20-20'
alias mpv_media='mpv --geometry=25%-20+20'

mpv_media_pl() {
  local url="$1"
  local start="${2:-1}"
  mpv_media --save-position-on-quit --playlist-start="$start" "$url"
}

#══════════════════════ 
#         ytfzf
#══════════════════════

# Descarga
alias yt="ytfzf -t" 
# Descarga Musica
alias yt-audio='ytfzf -dm' 


#══════════════════════ 
#        yt-dlp
#══════════════════════

# Descarga 
# Maxima Calidad Video 
# Maxima Calidad Audio 
alias ythd="yt-dlp -f bestvideo+bestaudio "

# Descarga Audio
alias dm="yt-dlp -x --audio-format mp3 "
alias dmb="yt-dlp -x --audio-quality 0"

# Nombre Personalizado
# alias yt-PlayList='yt-dlp -o "%(playlist)s/%(playlist_index)s - %(title)s.%(ext)s" "URL" '
# alias yt-PlayList-Music='yt-dlp -o "%(playlist)s/%(playlist_index)s - %(title)s.%(ext)s" "URL" -x'

ytD () {

    [[ -z "$1" ]] && { echo "No se ha ingresado URL"; return 1; }

    # Mostrar formatos disponibles
    yt-dlp -F "$1" || return 1

    # Solicitar formato de video
    echo -n "Ingrese el ID del formato de VIDEO: "
    read videoID

    # Descargar el video
    yt-dlp -f "${videoID}+bestaudio" \
    --embed-subs --write-auto-subs --sub-langs es,en \
    -t sleep -i \
    "$1"
    
    # Descargar subtítulos + Delay
    # echo -n "Descargando Subtitulos: "
    # yt-dlp --sub-lang "es,en" \
    #        --write-sub \
    #        --write-auto-sub \
    #        --sub-format "json3" \
    #        --convert-subs "srt" \
    #        -t sleep
}


#══════════════════════ 
#        spotdl
#══════════════════════

spotdlD(){
  [[ -z "$1" ]] && { echo "No se ha ingresado URL"; return 1; }
  spotdl  "$1" --format opus
}

spotdl_pull(){

  # Bucle
  while IFS= read -r -d '' ruta_File; do

    # VAR
    local ruta_Parent="$(dirname "$ruta_File")"
    local formato=$(ls "$ruta_Parent" | grep -Eo "(opus|mp3|m4a|ogg)$" | sort | uniq -c | sort -nr | head -n1 | awk '{print $2}')

    # Verificado
    [[ -z "$formato" ]] && formato="opus"

    # RUN
    spotdl --format "$formato" sync "$ruta_File" --overwrite skip  --output "$ruta_Parent"

  done < <(find . -name "*.spotdl" -print0)

}

spotdl_playlist() {

  [[ -z "$1" ]] && { echo "Ingrese la URL de la Playlist"; return 1; }

  local url=$1
  local file="predeterminado.spotdl"
  local ruta="{list-name}/{artists} - {title}.{output-ext}"
  local opts=("mp3 - Compatibilidad Total" "opus - Ligero Moderno Calidad")

  PS3="Selecciona formato [1-2]: "
  select opt in "${opts[@]}"; do
      case $REPLY in
          1) 
              spotdl sync "$url" --save-file "$file" --output "$ruta"
              break 
              ;;
          2) 
              spotdl sync "$url" --format opus --bitrate "disable" --save-file "$file" --output "$ruta"
              break 
              ;;
          *) 
              echo "Opción incorrecta, elija de nuevo." 
              ;;
      esac
  done


  local name=$(ls -dt * | head -n 1)

  mv "$file" "$name/Playlist_$name.spotdl"  # Renombro y Muevo

}


#════════════════════════════════════════════════════════════════════════════════════════════╗ 
#                                   Dependientes
#════════════════════════════════════════════════════════════════════════════════════════════╝



# [ANIMES]
alias Berserk="mpv_media_pl 'https://youtube.com/playlist?list=PLHaR5nU-RvtR3fx9t5h-cokPnxupdObxo&si=NFV-Xhu9Qw0vLqkm' "


# [MUSICA]
sync_Android-Spotify-Playlist(){

    # Rutas
    local ruta_Laptop="/run/media/carlosa/Disco/📁 Musica/Spotify"
    local ruta_Android="~/storage/music/Spotify_Playlist/"
    
    # Ejecucion
    rsync -avz -e "ssh" "Android:$ruta_Android" "$ruta_Laptop"  
}

